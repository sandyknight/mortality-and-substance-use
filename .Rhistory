by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NULL
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_poisoning_data(file_path = drug_poisoning_deaths_file)
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
process_deaths_in_treatment <- function(file_path,
years = c("2021", "2022"),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_poisoning_data(file_path = drug_poisoning_deaths_file)
process_deaths_in_treatment <- function(file_path,
years = c("2021", "2022"),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c("2021", "2022"),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>% print()
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2021, 2022),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2021, 2022),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>% select(period) %>% unique() %>% print()
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>% select(period) %>% unique() %>% print()
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NA_character_
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NULL
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
} else {
exc_poisoning <- NULL
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(by_death_cause)) {
exc_poisoning <- "Drug poisoning"
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(exclude_poisoning)) {
exc_poisoning <- "Drug poisoning"
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exclude_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
if (!is.null(by)) {
by_var <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age")
} else {
by_var <- NULL
}
if (isTRUE(by_treatment_status)) {
by_var <- append("treatment_status", by_var)
}
if (isTRUE(by_death_cause)) {
by_var <- append("death_cause", by_var)
}
if (isTRUE(exclude_poisoning)) {
exc_poisoning <- "Drug poisoning"
}
read_parquet(file_path) %>%
mutate(period = as.Date(period, origin = "1899-12-30")) %>%
mutate(period = lubridate::year(period)) %>%
filter(period %in% years, death_cause != exc_poisoning) %>%
group_by(pick(by_var), period) %>%
summarise(count = n(), .groups = "drop")
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
# Initialize grouping variables with 'period'
grouping_vars <- "period"
# Handle 'by' parameter
if (!is.null(by)) {
by_vars <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age",
stop("Invalid 'by' value. Choose 'area' or 'age', or leave as NULL.")
)
grouping_vars <- c(grouping_vars, by_vars)
}
# Add 'treatment_status' to grouping variables if required
if (isTRUE(by_treatment_status)) {
grouping_vars <- c(grouping_vars, "treatment_status")
}
# Add 'death_cause' to grouping variables if required
if (isTRUE(by_death_cause)) {
grouping_vars <- c(grouping_vars, "death_cause")
}
# Read and process data
data <- read_parquet(file_path) %>%
mutate(
period = as.Date(period, origin = "1899-12-30"),
period = lubridate::year(period)
)
# Filter data based on 'years' and 'exclude_poisoning'
data <- data %>%
filter(period %in% years)
if (isTRUE(exclude_poisoning)) {
data <- data %>%
filter(death_cause != "Drug poisoning")
}
# Group and summarize data
result <- data %>%
group_by(across(all_of(grouping_vars))) %>%
summarise(count = n(), .groups = "drop")
return(result)
}
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
read_parquet(deaths_in_treatment_file)
process_deaths_in_treatment <- function(file_path,
years = c(2022, 2023),
by = NULL,
by_treatment_status = FALSE,
by_death_cause = FALSE,
exclude_poisoning = TRUE) {
# Initialize grouping variables with 'period'
grouping_vars <- "period"
# Handle 'by' parameter
if (!is.null(by)) {
by_vars <- switch(by,
"area" = c("area_code", "area_name"),
"age" = "age",
stop("Invalid 'by' value. Choose 'area' or 'age', or leave as NULL.")
)
grouping_vars <- c(grouping_vars, by_vars)
}
# Add 'treatment_status' to grouping variables if required
if (isTRUE(by_treatment_status)) {
grouping_vars <- c(grouping_vars, "treatment_status")
}
# Add 'death_cause' to grouping variables if required
if (isTRUE(by_death_cause)) {
grouping_vars <- c(grouping_vars, "death_cause")
}
# Read and process data
data <- read_parquet(file_path) %>%
mutate(
period = as.Date(period, origin = "1899-12-30"),
period = lubridate::year(period)
)
# Filter data based on 'years' and 'exclude_poisoning'
data <- data %>%
filter(period %in% years)
if (isTRUE(exclude_poisoning)) {
data <- data %>%
filter(death_cause != "Drug poisoning")
}
# Group and summarize data
result <- data %>%
group_by(across(all_of(grouping_vars))) %>%
summarise(count = sum(count), .groups = "drop")
return(result)
}
read_parquet(deaths_in_treatment_file)
process_deaths_in_treatment(file_path = deaths_in_treatment_file, by_death_cause = TRUE)
